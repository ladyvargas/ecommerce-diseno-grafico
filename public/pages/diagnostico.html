<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagn√≥stico - CNC CAMPAS</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 2rem;
            background: #f3f4f6;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        h1 { color: #1a1a2e; margin-bottom: 2rem; }
        h2 { color: #374151; margin: 2rem 0 1rem; }
        .test-section {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: #f9fafb;
            border-radius: 8px;
        }
        button {
            padding: 0.75rem 1.5rem;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            margin-right: 1rem;
        }
        button:hover { background: #2563eb; }
        .result {
            margin-top: 1rem;
            padding: 1rem;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            font-family: monospace;
            white-space: pre-wrap;
            word-wrap: break-word;
            max-height: 400px;
            overflow-y: auto;
        }
        .success { color: #10b981; font-weight: 600; }
        .error { color: #ef4444; font-weight: 600; }
        .info { color: #3b82f6; font-weight: 600; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Diagn√≥stico del Sistema CNC CAMPAS</h1>
        
        <div class="test-section">
            <h2>1. Test API Orders</h2>
            <button onclick="testOrdersAll()">GET /api/orders/all</button>
            <button onclick="testOrdersGuest()">GET /api/orders/guest/1</button>
            <div id="ordersResult" class="result"></div>
        </div>

        <div class="test-section">
            <h2>2. Test API Products</h2>
            <button onclick="testProducts()">GET /api/products</button>
            <div id="productsResult" class="result"></div>
        </div>

        <div class="test-section">
            <h2>3. localStorage Info</h2>
            <button onclick="checkLocalStorage()">Ver localStorage</button>
            <button onclick="clearLocalStorage()">Limpiar localStorage</button>
            <div id="localStorageResult" class="result"></div>
        </div>

        <div class="test-section">
            <h2>4. Crear Pedido de Prueba</h2>
            <button onclick="createTestOrder()">Crear Pedido</button>
            <div id="createOrderResult" class="result"></div>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:3000/api';

        async function testOrdersAll() {
            const result = document.getElementById('ordersResult');
            result.innerHTML = '<span class="info">‚è≥ Cargando...</span>';
            
            try {
                const response = await fetch(`${API_URL}/orders/all`);
                const data = await response.json();
                
                if (response.ok) {
                    result.innerHTML = `<span class="success">‚úÖ Success (${response.status})</span>\n\n`;
                    result.innerHTML += `Total pedidos: ${data.length}\n\n`;
                    result.innerHTML += JSON.stringify(data, null, 2);
                } else {
                    result.innerHTML = `<span class="error">‚ùå Error (${response.status})</span>\n\n`;
                    result.innerHTML += JSON.stringify(data, null, 2);
                }
            } catch (error) {
                result.innerHTML = `<span class="error">‚ùå Error de red:</span>\n\n${error.message}`;
            }
        }

        async function testOrdersGuest() {
            const result = document.getElementById('ordersResult');
            result.innerHTML = '<span class="info">‚è≥ Cargando pedido #1...</span>';
            
            try {
                const response = await fetch(`${API_URL}/orders/guest/1`);
                const data = await response.json();
                
                if (response.ok) {
                    result.innerHTML = `<span class="success">‚úÖ Success (${response.status})</span>\n\n`;
                    result.innerHTML += JSON.stringify(data, null, 2);
                } else {
                    result.innerHTML = `<span class="error">‚ùå Error (${response.status})</span>\n\n`;
                    result.innerHTML += JSON.stringify(data, null, 2);
                }
            } catch (error) {
                result.innerHTML = `<span class="error">‚ùå Error de red:</span>\n\n${error.message}`;
            }
        }

        async function testProducts() {
            const result = document.getElementById('productsResult');
            result.innerHTML = '<span class="info">‚è≥ Cargando...</span>';
            
            try {
                const response = await fetch(`${API_URL}/products`);
                const data = await response.json();
                
                if (response.ok) {
                    result.innerHTML = `<span class="success">‚úÖ Success (${response.status})</span>\n\n`;
                    result.innerHTML += `Total productos: ${data.length}\n\n`;
                    result.innerHTML += JSON.stringify(data.slice(0, 3), null, 2);
                } else {
                    result.innerHTML = `<span class="error">‚ùå Error (${response.status})</span>\n\n`;
                    result.innerHTML += JSON.stringify(data, null, 2);
                }
            } catch (error) {
                result.innerHTML = `<span class="error">‚ùå Error de red:</span>\n\n${error.message}`;
            }
        }

        function checkLocalStorage() {
            const result = document.getElementById('localStorageResult');
            const data = {
                userEmail: localStorage.getItem('userEmail'),
                userName: localStorage.getItem('userName'),
                cart: localStorage.getItem('cart'),
                token: localStorage.getItem('token'),
                user: localStorage.getItem('user')
            };
            result.innerHTML = '<span class="info">üì¶ localStorage:</span>\n\n';
            result.innerHTML += JSON.stringify(data, null, 2);
        }

        function clearLocalStorage() {
            if (confirm('¬øLimpiar todo el localStorage?')) {
                localStorage.clear();
                checkLocalStorage();
                alert('‚úÖ localStorage limpiado');
            }
        }

        async function createTestOrder() {
            const result = document.getElementById('createOrderResult');
            result.innerHTML = '<span class="info">‚è≥ Creando pedido de prueba...</span>';
            
            const orderData = {
                customerName: 'Test Usuario',
                customerEmail: 'test@diagnostico.com',
                customerPhone: '+593991234567',
                notes: 'Pedido creado desde diagn√≥stico',
                items: [
                    { productId: 1, quantity: 2, price: 45.00 }
                ],
                subtotal: 90.00,
                tax: 10.80,
                total: 100.80,
                paymentMethod: 'transfer'
            };

            try {
                const response = await fetch(`${API_URL}/orders/create-guest`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(orderData)
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    result.innerHTML = `<span class="success">‚úÖ Pedido creado! ID: ${data.order.id}</span>\n\n`;
                    result.innerHTML += JSON.stringify(data, null, 2);
                    result.innerHTML += '\n\nAhora puedes probar GET /api/orders/all';
                } else {
                    result.innerHTML = `<span class="error">‚ùå Error (${response.status})</span>\n\n`;
                    result.innerHTML += JSON.stringify(data, null, 2);
                }
            } catch (error) {
                result.innerHTML = `<span class="error">‚ùå Error de red:</span>\n\n${error.message}`;
            }
        }

        // Auto-test al cargar
        window.addEventListener('load', () => {
            checkLocalStorage();
        });
    </script>
</body>
</html>
