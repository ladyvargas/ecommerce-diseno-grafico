<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CNC CAMPAS - Fabricación Digital Profesional</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/css/footer.css">
    <link rel="stylesheet" href="/css/main.css">
</head>

<body>
    <!-- HEADER -->
    <header>
        <div class="header-container">
            <img src="/img/logo.png" alt="CNC CAMPAS" class="logo">
            <nav>
                <a href="/">Inicio</a>
                <a href="/pages/productos.html">Productos</a>
                <a href="/pages/about.html">Sobre Nosotros</a>
                <a href="#contacto">Contacto</a>
            </nav>
            <div class="header-icons">
                <button class="icon-btn" onclick="window.location.href='/cart'">
                    <i class="fas fa-shopping-cart"></i>
                    <span id="cartCount" class="cart-count" style="display: none;">0</span>
                </button>
                <div class="user-menu-container">
                    <button class="icon-btn" onclick="toggleUserMenu()" id="userMenuBtn">
                        <i class="fas fa-user"></i>
                    </button>
                    <div class="user-dropdown" id="userDropdown" style="display: none;">
                        <div class="user-info" id="userInfo">
                            <i class="fas fa-user-circle"></i>
                            <span id="userName">Usuario</span>
                        </div>
                        <a href="/pages/mis-pedidos.html" class="dropdown-item">
                            <i class="fas fa-shopping-bag"></i> Mis Pedidos
                        </a>
                        <a href="/pages/admin-pro.html" class="dropdown-item" id="adminLink" style="display: none;">
                            <i class="fas fa-cog"></i> Panel Admin
                        </a>
                        <div class="dropdown-divider"></div>
                        <button onclick="logout()" class="dropdown-item logout-btn">
                            <i class="fas fa-sign-out-alt"></i> Cerrar Sesión
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- HERO SECTION CON CARRUSEL - 3 SECCIONES -->
    <section class="main-banner" id="heroSection">
        <!-- SECCIÓN 1: CONTENIDO TEXTO -->
        <div class="brown-side">
            <div class="content" id="heroContent">
                <h1 id="heroTitle">CORTE Y DESBASTE CNC ROUTER PROFESIONAL</h1>
                <p id="heroDescription">Servicio de corte preciso y profesional para madera, plywood y MDF. Ideal para
                    piezas personalizadas, producción en serie y acabados limpios con alta exactitud. Precisión y
                    calidad en cada corte.</p>
                <button class="btn-cta">Contratar ahora</button>
            </div>
        </div>
        <div class="oval-mask"></div>
        <div class="oval-line"></div>

        <!-- SECCIÓN 2: IMAGEN -->
        <div class="machine-box">
            <img id="machineImage" src="https://images.unsplash.com/photo-1565024640326-b2ae7c1c2fd9?w=800&q=80"
                alt="Router CNC">
        </div>

        <!-- SECCIÓN 3: BOTONES LATERALES -->
        <div class="tags-side" id="heroImage">
            <button class="tag active" data-machine="router-cnc">ROUTER CNC</button>
            <button class="tag" data-machine="grabador-laser">CORTE LASER</button>
            <button class="tag" data-machine="impresora-uv">IMPRESORA UV</button>
            <button class="tag" data-machine="impresora-3d">IMPRESORA 3D</button>
            <button class="tag" data-machine="plotter-corte">PLOTTER</button>
            <button class="tag" data-machine="sublimacion">SUBLIMACION</button>
        </div>
    </section>

    <!-- PRODUCTOS DESTACADOS -->
    <section class="productos-section">
        <h2>PRODUCTOS DESTACADOS</h2>
        <p class="productos-subtitle">Descubre nuestros servicios más solicitados con la mejor calidad y precisión</p>
        <div class="productos-grid" id="productosGrid">
            <!-- Se cargan dinámicamente -->
        </div>
        <button class="ver-todos-btn" onclick="window.location.href='/pages/productos.html'">
            Ver Todos los Productos
        </button>
    </section>

    <!-- NUESTROS SERVICIOS -->
    <section class="services-section">
        <div class="services-header">
            <h2>NUESTROS SERVICIOS</h2>
            <p class="services-subtitle">Soluciones profesionales de fabricación digital</p>
        </div>

        <!-- Servicios Destacados (2 grandes) -->
        <div class="services-featured">
            <div class="service-card-large">
                <div class="service-card-content">
                    <div class="service-number">01</div>
                    <div class="service-icon-large">
                        <i class="fas fa-cog"></i>
                    </div>
                    <h3>Router CNC Profesional</h3>
                    <p>Corte y mecanizado CNC de alta precisión en madera, MDF, plywood, PVC y alucobond. Ideal para
                        letras corpóreas, displays y piezas personalizadas con acabados perfectos.</p>
                    <div class="service-tags">
                        <span>Madera</span>
                        <span>MDF</span>
                        <span>Acrílico</span>
                        <span>PVC</span>
                    </div>
                </div>
                <div class="service-decoration"></div>
            </div>

            <div class="service-card-large">
                <div class="service-card-content">
                    <div class="service-number">02</div>
                    <div class="service-icon-large">
                        <i class="fas fa-cut"></i>
                    </div>
                    <h3>Corte y Grabado Láser</h3>
                    <p>Corte y grabado láser de precisión en múltiples materiales. Perfecto para diseños detallados,
                        señalética personalizada y productos de alta calidad con acabados excepcionales.</p>
                    <div class="service-tags">
                        <span>Alta Precisión</span>
                        <span>Grabado</span>
                        <span>Detalles Finos</span>
                    </div>
                </div>
                <div class="service-decoration"></div>
            </div>
        </div>

        <!-- Servicios Secundarios (4 medianas) -->
        <div class="services-grid-compact">
            <div class="service-card-medium">
                <div class="service-icon-medium">
                    <i class="fas fa-print"></i>
                </div>
                <h3>Impresión UV</h3>
                <p>Impresión directa UV sobre cualquier superficie con colores vibrantes y durabilidad excepcional.</p>
                <div class="service-link">
                    <i class="fas fa-arrow-right"></i>
                </div>
            </div>

            <div class="service-card-medium">
                <div class="service-icon-medium">
                    <i class="fas fa-cube"></i>
                </div>
                <h3>Impresión 3D</h3>
                <p>Prototipado rápido y fabricación de piezas personalizadas con múltiples materiales disponibles.</p>
                <div class="service-link">
                    <i class="fas fa-arrow-right"></i>
                </div>
            </div>

            <div class="service-card-medium">
                <div class="service-icon-medium">
                    <i class="fas fa-image"></i>
                </div>
                <h3>Plotter Gran Formato</h3>
                <p>Impresión de gran formato para vallas publicitarias, rótulos, banners y lonas de alta calidad.</p>
                <div class="service-link">
                    <i class="fas fa-arrow-right"></i>
                </div>
            </div>

            <div class="service-card-medium">
                <div class="service-icon-medium">
                    <i class="fas fa-lightbulb"></i>
                </div>
                <h3>Letreros LED</h3>
                <p>Fabricación de letreros LED luminosos personalizados con bajo consumo y máxima visibilidad.</p>
                <div class="service-link">
                    <i class="fas fa-arrow-right"></i>
                </div>
            </div>
        </div>
    </section>

    <!-- TESTIMONIOS -->
    <section class="testimonios-section">
        <h2>LO QUE DICEN NUESTROS CLIENTES</h2>
        <div class="testimonios-container">
            <div class="testimonio-card">
                <div class="testimonio-stars">★★★★★</div>
                <p class="testimonio-text">"Excelente servicio y calidad en el corte CNC. Los acabados son impecables y
                    la entrega fue puntual. Altamente recomendado."</p>
                <div class="testimonio-author">
                    <strong>María González</strong>
                    <span>Empresa de Diseño Interior</span>
                </div>
            </div>
            <div class="testimonio-card">
                <div class="testimonio-stars">★★★★★</div>
                <p class="testimonio-text">"El grabado láser quedó perfecto. Muy profesionales y atentos a los detalles.
                    Sin duda volveré a trabajar con ellos."</p>
                <div class="testimonio-author">
                    <strong>Carlos Mendoza</strong>
                    <span>Tienda de Regalos Personalizados</span>
                </div>
            </div>
            <div class="testimonio-card">
                <div class="testimonio-stars">★★★★★</div>
                <p class="testimonio-text">"Los letreros LED superaron nuestras expectativas. Excelente comunicación y
                    asesoría durante todo el proyecto."</p>
                <div class="testimonio-author">
                    <strong>Ana Ruiz</strong>
                    <span>Restaurante El Sabor</span>
                </div>
            </div>
        </div>
    </section>

    <!-- POR QUÉ ELEGIRNOS -->
    <section class="porque-section">
        <div class="porque-container">
            <div class="porque-content">
                <h2>¿POR QUÉ ELEGIRNOS?</h2>
                <div class="porque-grid">
                    <div class="porque-item">
                        <div class="porque-icon"><i class="fas fa-award"></i></div>
                        <h3>Calidad Garantizada</h3>
                        <p>Trabajos de alta calidad con los mejores acabados y atención al detalle.</p>
                    </div>
                    <div class="porque-item">
                        <div class="porque-icon"><i class="fas fa-clock"></i></div>
                        <h3>Entrega Puntual</h3>
                        <p>Cumplimos con los tiempos acordados sin comprometer la calidad.</p>
                    </div>
                    <div class="porque-item">
                        <div class="porque-icon"><i class="fas fa-tools"></i></div>
                        <h3>Tecnología Moderna</h3>
                        <p>Equipos de última generación para resultados profesionales.</p>
                    </div>
                    <div class="porque-item">
                        <div class="porque-icon"><i class="fas fa-headset"></i></div>
                        <h3>Asesoría Personalizada</h3>
                        <p>Te ayudamos a encontrar la mejor solución para tu proyecto.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- CONTACTO -->
    <section class="contacto-section" id="contacto">
        <div class="contacto-container">
            <div class="contacto-info">
                <h2>CONTÁCTANOS</h2>
                <div class="contacto-item">
                    <div class="contacto-icon"><i class="fas fa-map-marker-alt"></i></div>
                    <div>
                        <h4>Ubicación</h4>
                        <p>Esmeraldas, Ecuador</p>
                    </div>
                </div>
                <div class="contacto-item">
                    <div class="contacto-icon"><i class="fas fa-phone"></i></div>
                    <div>
                        <h4>Teléfono</h4>
                        <p>+593 XX XXX XXXX</p>
                    </div>
                </div>
                <div class="contacto-item">
                    <div class="contacto-icon"><i class="fas fa-envelope"></i></div>
                    <div>
                        <h4>Email</h4>
                        <p>info@cnccampas.com</p>
                    </div>
                </div>
                <div class="contacto-item">
                    <div class="contacto-icon"><i class="fas fa-clock"></i></div>
                    <div>
                        <h4>Horario</h4>
                        <p>Lun - Vie: 8:00 AM - 6:00 PM</p>
                    </div>
                </div>
            </div>

            <div class="contacto-form">
                <form id="contactForm">
                    <div class="form-group">
                        <label>Nombre</label>
                        <input type="text" required>
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" required>
                    </div>
                    <div class="form-group">
                        <label>Teléfono</label>
                        <input type="tel">
                    </div>
                    <div class="form-group">
                        <label>Mensaje</label>
                        <textarea required></textarea>
                    </div>
                    <button type="submit" class="form-submit">Enviar Mensaje</button>
                </form>
            </div>
        </div>
    </section>

    <script>
        // Datos de máquinas - SE CARGARÁN DINÁMICAMENTE
        let machines = {
            'router-cnc': {
                title: 'CORTE Y DESBASTE CNC ROUTER PROFESIONAL',
                description: 'Servicio de corte preciso y profesional para madera, plywood y MDF. Ideal para piezas personalizadas, producción en serie y acabados limpios con alta exactitud. Precisión y calidad en cada corte.',
                image: 'https://images.unsplash.com/photo-1612815154858-60aa4c59eaa6?w=800&q=80',
                class: 'router-cnc'
            },
            'grabador-laser': {
                title: 'GRABADOR Y CORTADORA LÁSER DE PRECISIÓN',
                description: 'Corte y grabado láser de alta precisión en múltiples materiales. Ideal para diseños detallados, señalética personalizada y productos de alta calidad. Tecnología de última generación.',
                image: 'https://images.unsplash.com/photo-1612815154858-60aa4c59eaa6?w=800&q=80',
                class: 'grabador-laser'
            },
            'impresora-uv': {
                title: 'IMPRESORA UV DE ALTA RESOLUCIÓN',
                description: 'Impresión UV directa sobre cualquier superficie sólida. Colores vibrantes y durabilidad excepcional en madera, acrílico, metal, vidrio y más. Calidad profesional garantizada.',
                image: 'https://images.unsplash.com/photo-1612815154858-60aa4c59eaa6?w=800&q=80',
                class: 'impresora-3d'
            },
            'impresora-3d': {
                title: 'IMPRESIÓN 3D PROFESIONAL - PROTOTIPOS Y PIEZAS',
                description: 'Impresión 3D de alta resolución para prototipos funcionales y piezas personalizadas. Múltiples materiales disponibles con acabados profesionales. Precisión en cada capa.',
                image: 'https://images.unsplash.com/photo-1614025767867-c072ca0cdc18?w=800&q=80',
                class: 'impresora-3d'
            },
            'plotter-corte': {
                title: 'PLOTTER DE CORTE GIGANTOGRAFÍAS',
                description: 'Plotter de corte profesional para vinilo, papel y gigantografías. Ideal para señalética, rotulación y trabajos publicitarios de gran formato. Cortes limpios y precisos.',
                image: 'https://images.unsplash.com/photo-1611162617213-7d7a39e9b1d7?w=800&q=80',
                class: 'plotter-corte'
            },
            'sublimacion': {
                title: 'SUBLIMACIÓN PROFESIONAL TEXTIL',
                description: 'Servicio de sublimación en textiles y objetos personalizados. Colores intensos y permanentes en telas, tazas, mouse pads y más. Calidad duradera.',
                image: 'https://images.unsplash.com/photo-1618354691373-d851c5c3a990?w=800&q=80',
                class: 'router-cnc'
            }
        };

        let currentMachine = 'router-cnc';
        let autoplayInterval;

        function normalizeText(text) {
            return text
                .toLowerCase()
                .normalize("NFD")
                .replace(/[\u0300-\u036f]/g, "")
                .trim();
        }
        const categoryMap = {
            'mecanizado cnc': 'router-cnc',
            'corte y grabado laser': 'grabador-laser',
            'impresion uv': 'impresora-uv',
            'prototipos e impresion 3d': 'impresora-3d',
            'letreros y senaletica': 'plotter-corte',
            'publicidad y rotulacion': 'sublimacion'
        };


        // CARGAR IMÁGENES DESDE LA BASE DE DATOS
        async function loadMachineImages() {
            try {
                const API_URL = 'http://localhost:3000/api';
                const response = await fetch(`${API_URL}/products`);
                const products = await response.json();

                products.forEach(product => {
                    if (!product.category || !product.image) return;

                    const normalizedCategory = normalizeText(product.category);
                    const machineKey = categoryMap[normalizedCategory];

                    console.log(
                        'BD:',
                        product.category,
                        '→',
                        normalizedCategory,
                        '→',
                        machineKey
                    );

                    // Solo tomamos la PRIMERA imagen válida por categoría
                    if (machineKey && machines[machineKey] && !machines[machineKey]._fromDB) {
                        machines[machineKey].image = product.image;
                        machines[machineKey]._fromDB = true; // flag interno
                        console.log(`✔ Imagen aplicada a ${machineKey}:`, product.image);
                    }
                });
                // Actualizar imagen inicial
                changeMachine(currentMachine);
            } catch (error) {
                console.error('Error cargando imágenes de máquinas:', error);
                // Si falla, usar imágenes por defecto (ya están en machines)
            }
        }

        // Cambiar máquina
        function changeMachine(machineKey) {
            const machine = machines[machineKey];
            if (!machine) return;

            currentMachine = machineKey;

            // Texto
            document.getElementById('heroTitle').textContent = machine.title;
            document.getElementById('heroDescription').textContent = machine.description;

            // Imagen
            const img = document.getElementById('machineImage');
            if (img) img.src = machine.image;

            // Clase visual (si la usas en CSS)
            const heroSection = document.getElementById('heroSection');
            heroSection.className = 'main-banner ' + machine.class;

            // Botones activos
            document.querySelectorAll('.tag').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.machine === machineKey) {
                    btn.classList.add('active');
                }
            });
        }

        // Autoplay
        function startAutoplay() {
            const machineKeys = Object.keys(machines);
            let currentIndex = 0;

            autoplayInterval = setInterval(() => {
                currentIndex = (currentIndex + 1) % machineKeys.length;
                changeMachine(machineKeys[currentIndex]);
            }, 5000); // Cambiar cada 5 segundos
        }

        function resetAutoplay() {
            clearInterval(autoplayInterval);
            startAutoplay();
        }

        // Cargar productos
        async function loadProducts() {
            try {
                const response = await fetch('https://ecommerce-diseno-grafico-production.up.railway.app/api/products');
                const products = await response.json();

                const featured = products.filter(p => p.featured).slice(0, 6);
                const grid = document.getElementById('productosGrid');

                grid.innerHTML = featured.map(product => {
                    // Convertir precios a números
                    const price = parseFloat(product.price) || 0;
                    const salePrice = product.sale_price ? parseFloat(product.sale_price) : null;
                    const precio = salePrice || price;
                    const descuento = salePrice ? Math.round(((price - salePrice) / price) * 100) : 0;

                    return `
                        <div class="producto-card">
                            <div class="producto-img-container">
                                <img src="${product.image}" alt="${product.name}" class="producto-img">
                                ${product.featured && product.trending ?
                            '<div class="producto-badge destacado">✨ Destacado</div>' :
                            salePrice ?
                                `<div class="producto-badge oferta">-${descuento}% OFF</div>` :
                                ''
                        }
                            </div>
                            <div class="producto-content">
                                <div class="producto-categoria">${product.category}</div>
                                <h3>${product.name}</h3>
                                <p class="producto-description">${product.description}</p>
                                <div class="producto-footer">
                                    <div class="producto-precio-container">
                                        ${salePrice ?
                            `<div class="producto-precio-old">$${price.toFixed(2)}</div>` :
                            ''
                        }
                                        <div class="producto-precio">$${precio.toFixed(2)}</div>
                                    </div>
                                    <button class="producto-btn" onclick="window.location.href='/pages/product.html?id=${product.id}'">
                                        Ver más <i class="fas fa-arrow-right"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            } catch (error) {
                console.error('Error cargando productos:', error);
                document.getElementById('productosGrid').innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 3rem; color: #666;">
                        <i class="fas fa-exclamation-circle" style="font-size: 3rem; margin-bottom: 1rem; color: #ccc;"></i>
                        <p>No se pudieron cargar los productos. Intenta recargar la página.</p>
                    </div>
                `;
            }
        }

        // Cargar galería
        async function loadGallery() {
            try {
                const response = await fetch('https://ecommerce-diseno-grafico-production.up.railway.app/api/products');
                const products = await response.json();

                // Tomar solo productos que tengan imagen
                const galleryProducts = products
                    .filter(p => p.image)
                    .slice(0, 9); // máximo 9

                const grid = document.getElementById('galeriaGrid');

                if (!galleryProducts.length) {
                    grid.innerHTML = `
        <div style="grid-column: 1/-1; text-align: center; padding: 3rem;">
          <p>No hay productos para mostrar</p>
        </div>
      `;
                    return;
                }

                grid.innerHTML = galleryProducts.map(p => `
      <div class="galeria-item">
        <img src="${p.image}" alt="${p.name}">
        <div class="galeria-overlay">
          <h3>${p.name}</h3>
          <p>${p.category}</p>
        </div>
      </div>
    `).join('');

            } catch (error) {
                console.error('Error cargando galería dinámica:', error);
            }
        }


        // Form submit
        document.getElementById('contactForm').addEventListener('submit', (e) => {
            e.preventDefault();
            alert('¡Mensaje enviado! Nos pondremos en contacto pronto.');
            e.target.reset();
        });

        // User Menu
        let userMenuOpen = false;

        function toggleUserMenu() {
            const dropdown = document.getElementById('userDropdown');
            userMenuOpen = !userMenuOpen;
            dropdown.style.display = userMenuOpen ? 'block' : 'none';
        }

        // Cerrar menú al hacer click fuera
        document.addEventListener('click', (e) => {
            const userMenu = document.querySelector('.user-menu-container');
            if (userMenu && !userMenu.contains(e.target) && userMenuOpen) {
                toggleUserMenu();
            }
        });

        // Función de logout
        function logout() {
            if (confirm('¿Estás seguro de que deseas cerrar sesión?')) {
                localStorage.removeItem('token');
                localStorage.removeItem('user');
                localStorage.removeItem('cart'); // Opcional: limpiar carrito
                window.location.href = '/';
            }
        }

        // Actualizar info de usuario al cargar
        window.addEventListener('DOMContentLoaded', () => {
            const user = JSON.parse(localStorage.getItem('user') || '{}');
            const cart = JSON.parse(localStorage.getItem('cart') || '[]');

            // Actualizar nombre de usuario
            if (user.name) {
                document.getElementById('userName').textContent = user.name;
            }

            // Mostrar link de admin si es admin
            if (user.role === 'admin') {
                document.getElementById('adminLink').style.display = 'flex';
            }

            // Actualizar contador de carrito
            if (cart.length > 0) {
                const cartCount = document.getElementById('cartCount');
                cartCount.textContent = cart.length;
                cartCount.style.display = 'block';
            }
            // LISTENERS DE BOTONES DEL BANNER
            document.querySelectorAll('.tag[data-machine]').forEach(btn => {
                btn.addEventListener('click', () => {
                    changeMachine(btn.dataset.machine);
                    resetAutoplay();
                });
            });
        });

        // Iniciar - IMPORTANTE: Cargar imágenes primero
        window.addEventListener('load', async () => {
            await loadMachineImages(); // Cargar imágenes desde BD
            await loadProducts();      // Cargar productos
            startAutoplay();           // Iniciar carrusel
        });

        // Scroll suave
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({ behavior: 'smooth' });
                }
            });
        });
    </script>

    <!-- ✨ APLICAR COLORES ESTANDARIZADOS -->
    <script src="/js/apply-colors.js"></script>
    <script src="/js/common-footer.js"></script>
</body>

</html>