<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CNC CAMPAS - Fabricaci√≥n Digital Profesional</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/css/footer.css">
    <link rel="stylesheet" href="/css/main.css">
</head>

<body>
    <!-- HEADER -->
    <header>
        <div class="header-container">
            <img src="/img/logo.png" alt="CNC CAMPAS" class="logo">
            <nav id="mainNav">
                <a href="/">Inicio</a>
                <a href="/pages/productos.html">Tienda Virtual</a>
                <a href="/pages/services.html">Servicios</a>
                <a href="/pages/about.html">Sobre Nosotros</a>
                <a href="#contacto">Contacto</a>

                <!-- OPCIONES USUARIO SOLO M√ìVIL -->
                <div class="mobile-user-menu">
                    <a href="/pages/mis-pedidos.html">Mis Pedidos</a>
                    <a href="/pages/admin-pro.html" id="adminLinkMobile" style="display:none;">
                        Panel Admin
                    </a>
                    <button onclick="logout()" class="logout-mobile">
                        Cerrar Sesi√≥n
                    </button>
                </div>
            </nav>

            <div class="header-icons">
                <!-- CARRITO -->
                <button class="icon-btn" onclick="window.location.href='/cart'">
                    <i class="fas fa-shopping-cart"></i>
                    <span id="cartCount" class="cart-count" style="display: none;">0</span>
                </button>

                <!-- HAMBURGER -->
                <button class="hamburger" id="hamburgerBtn" aria-label="Men√∫">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>

                <!-- USUARIO SOLO DESKTOP -->
                <div class="user-menu-container desktop-only">
                    <button class="icon-btn" id="userMenuBtn">
                        <i class="fas fa-user"></i>
                    </button>

                    <div class="user-dropdown" id="userDropdown" style="display: none;">
                        <div class="user-info" id="userInfo">
                            <i class="fas fa-user-circle"></i>
                            <span id="userName">Usuario</span>
                        </div>
                        <a href="/pages/mis-pedidos.html" class="dropdown-item">
                            <i class="fas fa-shopping-bag"></i> Mis Pedidos
                        </a>
                        <a href="/pages/admin-pro.html" class="dropdown-item" id="adminLink" style="display: none;">
                            <i class="fas fa-cog"></i> Panel Admin
                        </a>
                        <div class="dropdown-divider"></div>
                        <button onclick="logout()" class="dropdown-item logout-btn" id="logoutBtn">
                            <i class="fas fa-sign-out-alt"></i> Cerrar Sesi√≥n
                        </button>
                        <div id="userGuest" style="display:none;">
                            <a href="/pages/login.html" class="dropdown-item">
                                <i class="fas fa-sign-in-alt"></i> Iniciar Sesi√≥n
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- HERO SECTION CON CARRUSEL - 3 SECCIONES -->
    <section class="main-banner" id="heroSection">
        <!-- SECCI√ìN 1: CONTENIDO TEXTO -->
        <div class="brown-side">
            <div class="content" id="heroContent">
                <h1 id="heroTitle">CORTE Y DESBASTE CNC ROUTER PROFESIONAL</h1>
                <p id="heroDescription">Servicio de corte preciso y profesional para madera, plywood y MDF. Ideal para
                    piezas personalizadas, producci√≥n en serie y acabados limpios con alta exactitud. Precisi√≥n y
                    calidad en cada corte.</p>
                <button class="btn-cta" onclick="window.location.href='/pages/services.html'">
                    Contratar ahora
                </button>
            </div>
        </div>
        <div class="oval-mask"></div>
        <div class="oval-line"></div>

        <!-- SECCI√ìN 2: IMAGEN -->
        <div class="machine-box">
            <img id="machineImage" src="https://images.unsplash.com/photo-1565024640326-b2ae7c1c2fd9?w=800&q=80"
                alt="Router CNC">
        </div>

        <!-- SECCI√ìN 3: BOTONES LATERALES -->
        <div class="tags-side" id="heroImage">
            <button class="tag active" data-machine="router-cnc">ROUTER CNC</button>
            <button class="tag" data-machine="corte-laser">CORTE L√ÅSER</button>
            <button class="tag" data-machine="laser-fibra">L√ÅSER FIBRA</button>
            <button class="tag" data-machine="impresora-uv">IMPRESORA UV</button>
            <button class="tag" data-machine="impresora-3d">IMPRESORA 3D</button>
            <button class="tag" data-machine="plotter">PLOTTER</button>
            <button class="tag" data-machine="sublimacion">SUBLIMACION</button>
        </div>
    </section>

    <!-- PRODUCTOS DESTACADOS -->
    <section class="productos-section">
        <h2>PRODUCTOS DESTACADOS</h2>
        <p class="productos-subtitle">Descubre nuestros servicios m√°s solicitados con la mejor calidad y precisi√≥n</p>
        <div class="productos-grid" id="productosGrid">
            <!-- Se cargan din√°micamente -->
        </div>
        <button class="ver-todos-btn" onclick="window.location.href='/pages/productos.html'">
            Ver Todos los Productos
        </button>
    </section>

    <!-- NUESTROS SERVICIOS -->
    <section class="services-section">
        <div class="services-header">
            <h2>NUESTROS SERVICIOS</h2>
            <p class="services-subtitle">Soluciones profesionales de fabricaci√≥n digital</p>
        </div>

        <!-- Servicios Destacados (2 grandes) -->
        <div class="services-featured">
            <div class="service-card-large">
                <div class="service-card-content">
                    <div class="service-number">01</div>
                    <div class="service-icon-large">
                        <i class="fas fa-cog"></i>
                    </div>
                    <h3>Router CNC Profesional</h3>
                    <p>Corte y mecanizado CNC de alta precisi√≥n en madera, MDF, plywood, PVC y alucobond. Ideal para
                        letras corp√≥reas, displays y piezas personalizadas con acabados perfectos.</p>
                    <div class="service-tags">
                        <span>Madera</span>
                        <span>MDF</span>
                        <span>Acr√≠lico</span>
                        <span>PVC</span>
                    </div>
                </div>
                <div class="service-decoration"></div>
            </div>

            <div class="service-card-large">
                <div class="service-card-content">
                    <div class="service-number">02</div>
                    <div class="service-icon-large">
                        <i class="fas fa-cut"></i>
                    </div>
                    <h3>Corte y Grabado L√°ser</h3>
                    <p>Corte y grabado l√°ser de precisi√≥n en m√∫ltiples materiales. Perfecto para dise√±os detallados,
                        se√±al√©tica personalizada y productos de alta calidad con acabados excepcionales.</p>
                    <div class="service-tags">
                        <span>Alta Precisi√≥n</span>
                        <span>Grabado</span>
                        <span>Detalles Finos</span>
                    </div>
                </div>
                <div class="service-decoration"></div>
            </div>
        </div>

        <!-- Servicios Secundarios (4 medianas) -->
        <div class="services-grid-compact">
            <div class="service-card-medium">
                <div class="service-icon-medium">
                    <i class="fas fa-print"></i>
                </div>
                <h3>Impresi√≥n UV</h3>
                <p>Impresi√≥n directa UV sobre cualquier superficie con colores vibrantes y durabilidad excepcional.</p>
                <div class="service-link">
                    <i class="fas fa-arrow-right"></i>
                </div>
            </div>

            <div class="service-card-medium">
                <div class="service-icon-medium">
                    <i class="fas fa-cube"></i>
                </div>
                <h3>Impresi√≥n 3D</h3>
                <p>Prototipado r√°pido y fabricaci√≥n de piezas personalizadas con m√∫ltiples materiales disponibles.</p>
                <div class="service-link">
                    <i class="fas fa-arrow-right"></i>
                </div>
            </div>

            <div class="service-card-medium">
                <div class="service-icon-medium">
                    <i class="fas fa-image"></i>
                </div>
                <h3>Plotter Gran Formato</h3>
                <p>Impresi√≥n de gran formato para vallas publicitarias, r√≥tulos, banners y lonas de alta calidad.</p>
                <div class="service-link">
                    <i class="fas fa-arrow-right"></i>
                </div>
            </div>

            <div class="service-card-medium">
                <div class="service-icon-medium">
                    <i class="fas fa-lightbulb"></i>
                </div>
                <h3>Letreros LED</h3>
                <p>Fabricaci√≥n de letreros LED luminosos personalizados con bajo consumo y m√°xima visibilidad.</p>
                <div class="service-link">
                    <i class="fas fa-arrow-right"></i>
                </div>
            </div>
        </div>
    </section>

    <!-- TESTIMONIOS -->
    <section class="testimonios-section">
        <h2>LO QUE DICEN NUESTROS CLIENTES</h2>
        <div class="testimonios-container">
            <div class="testimonio-card">
                <div class="testimonio-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
                <p class="testimonio-text">"Excelente servicio y calidad en el corte CNC. Los acabados son impecables y
                    la entrega fue puntual. Altamente recomendado."</p>
                <div class="testimonio-author">
                    <strong>Mar√≠a Gonz√°lez</strong>
                    <span>Empresa de Dise√±o Interior</span>
                </div>
            </div>
            <div class="testimonio-card">
                <div class="testimonio-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
                <p class="testimonio-text">"El grabado l√°ser qued√≥ perfecto. Muy profesionales y atentos a los detalles.
                    Sin duda volver√© a trabajar con ellos."</p>
                <div class="testimonio-author">
                    <strong>Carlos Mendoza</strong>
                    <span>Tienda de Regalos Personalizados</span>
                </div>
            </div>
            <div class="testimonio-card">
                <div class="testimonio-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
                <p class="testimonio-text">"Los letreros LED superaron nuestras expectativas. Excelente comunicaci√≥n y
                    asesor√≠a durante todo el proyecto."</p>
                <div class="testimonio-author">
                    <strong>Ana Ruiz</strong>
                    <span>Restaurante El Sabor</span>
                </div>
            </div>
        </div>
    </section>

    <!-- POR QU√â ELEGIRNOS -->
    <section class="porque-section">
        <div class="porque-container">
            <div class="porque-content">
                <h2>¬øPOR QU√â ELEGIRNOS?</h2>
                <div class="porque-grid">
                    <div class="porque-item">
                        <div class="porque-icon"><i class="fas fa-award"></i></div>
                        <h3>Calidad Garantizada</h3>
                        <p>Trabajos de alta calidad con los mejores acabados y atenci√≥n al detalle.</p>
                    </div>
                    <div class="porque-item">
                        <div class="porque-icon"><i class="fas fa-clock"></i></div>
                        <h3>Entrega Puntual</h3>
                        <p>Cumplimos con los tiempos acordados sin comprometer la calidad.</p>
                    </div>
                    <div class="porque-item">
                        <div class="porque-icon"><i class="fas fa-tools"></i></div>
                        <h3>Tecnolog√≠a Moderna</h3>
                        <p>Equipos de √∫ltima generaci√≥n para resultados profesionales.</p>
                    </div>
                    <div class="porque-item">
                        <div class="porque-icon"><i class="fas fa-headset"></i></div>
                        <h3>Asesor√≠a Personalizada</h3>
                        <p>Te ayudamos a encontrar la mejor soluci√≥n para tu proyecto.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- CONTACTO -->
    <!-- CONTACTO -->
    <section class="contacto-section" id="contacto">
        <h2 class="contacto-title">CONT√ÅCTANOS</h2>
        <p class="contacto-subtitle">
            Estamos listos para ayudarte en tus proyectos de corte, grabado e impresi√≥n profesional.
        </p>
        <div class="contacto-grid">
            <div class="contacto-card">
                <i class="fas fa-map-marker-alt"></i>
                <h4>Ubicaci√≥n</h4>
                <p id="contactAddress">Cargando...</p>
            </div>

            <div class="contacto-card">
                <i class="fas fa-phone"></i>
                <h4>Tel√©fono</h4>
                <p id="contactPhone">Cargando...</p>
            </div>

            <div class="contacto-card">
                <i class="fas fa-envelope"></i>
                <h4>Email</h4>
                <p id="contactEmail">Cargando...</p>
            </div>

            <div class="contacto-card">
                <i class="fas fa-clock"></i>
                <h4>Horario</h4>
                <p id="contactHours">Cargando...</p>
            </div>
        </div>
    </section>

    <script>
        // Datos de m√°quinas - SE CARGAR√ÅN DIN√ÅMICAMENTE
        const BANNER_ORDER = ['router-cnc', 'corte-laser', 'laser-fibra', 'impresora-uv', 'impresora-3d', 'plotter', 'sublimacion'];

        const machines = {
            'router-cnc': {
                title: 'CORTE Y DESBASTE CNC ROUTER PROFESIONAL',
                description: 'Servicio de corte preciso y profesional para madera, plywood y MDF. Ideal para piezas personalizadas, producci√≥n en serie y acabados limpios con alta exactitud.',
                class: 'router-cnc',
                colors: {
                    primary: '#6b4423',
                    primaryDark: '#1a1a1a',
                    accent: '#CDA870',
                    gradient: 'radial-gradient(circle at 15% 25%, #a6734c 0%, #633d26 100%)'
                }
            },
            'corte-laser': {
                title: 'CORTE Y GRABADO L√ÅSER PROFESIONAL',
                description: 'Cortamos y grabamos con l√°ser de alta precisi√≥n, logrando detalles finos y bordes limpios en m√∫ltiples materiales.',
                class: 'grabador-laser',
                colors: {
                    primary: '#243977',
                    primaryDark: '#243977',
                    accent: '#CDA870',
                    gradient: 'radial-gradient(circle at 15% 25%, #2c4389 0%, #243977 100%)'
                }
            },
            'laser-fibra': {
                title: 'GRABADO L√ÅSER DE FIBRA INDUSTRIAL',
                description: 'Grabado de alta precisi√≥n sobre materiales industriales, ideal para marcaje permanente, placas, herramientas y piezas t√©cnicas.',
                class: 'laser-fibra',
                colors: {
                    primary: '#6b4423',
                    primaryDark: '#1a1a1a',
                    accent: '#CDA870',
                    gradient: 'radial-gradient(circle at 15% 25%, #a6734c 0%, #633d26 100%)'
                }
            },
            'impresora-uv': {
                title: 'IMPRESI√ìN UV DTF DE ALTA CALIDAD',
                description: 'Impresi√≥n UV directa sobre una amplia variedad de materiales como madera, acr√≠lico, vidrio, metal y PVC.',
                class: 'impresora-uv',
                colors: {
                    primary: '#243977',
                    primaryDark: '#243977',
                    accent: '#CDA870',
                    gradient: 'radial-gradient(circle at 15% 25%, #2c4389 0%, #243977 100%)'
                }
            },

            'impresora-3d': {
                title: 'IMPRESI√ìN 3D PROFESIONAL',
                description: 'Realizamos impresi√≥n 3D personalizada para prototipos, piezas t√©cnicas, repuestos y objetos decorativos.',
                class: 'impresora-3d',
                colors: {
                    primary: '#6b4423',
                    primaryDark: '#1a1a1a',
                    accent: '#CDA870',
                    gradient: 'radial-gradient(circle at 15% 25%, #a6734c 0%, #633d26 100%)'
                }
            },

            'plotter': {
                title: 'PLOTTER DE IMPRESI√ìN GRAN FORMATO',
                description: 'Impresi√≥n profesional hasta 1.80 metros, ideal para banners, vinilos, gigantograf√≠as y rotulaci√≥n comercial.',
                class: 'plotter-corte',
                colors: {
                    primary: '#243977',
                    primaryDark: '#243977',
                    accent: '#CDA870',
                    gradient: 'radial-gradient(circle at 15% 25%, #2c4389 0%, #243977 100%)'
                }
            },

            'sublimacion': {
                title: 'SUBLIMACI√ìN PROFESIONAL',
                description: 'Servicio de sublimaci√≥n profesional en textiles y productos promocionales. Colores intensos y permanentes en camisetas, tazas, gorras, mouse pads y art√≠culos personalizados.',
                class: 'sublimacion',
                colors: {
                    primary: '#6b4423',
                    primaryDark: '#1a1a1a',
                    accent: '#CDA870',
                    gradient: 'radial-gradient(circle at 15% 25%, #a6734c 0%, #633d26 100%)'
                }
            }
        };

        let currentMachine = 'router-cnc';
        let autoplayInterval;

        function normalizeText(text = '') {
            return text
                .toLowerCase()
                .normalize('NFD')
                .replace(/[\u0300-\u036f]/g, '')
                .replace(/[^a-z0-9]+/g, '-')
                .replace(/(^-|-$)/g, '');
        }

        const categoryMap = {
            'letrero-corporeo-cnc': 'router-cnc',
            'corte-y-grabado-laser-profesional': 'corte-laser',
            'servicio-de-impresion-uv-dtf': 'impresora-uv',
            'impresion-profesional-3d': 'impresora-3d',
            'grabado-laser-de-fibra': 'laser-fibra',
            'plotter-de-impresion': 'plotter',
            'sublimacion-profesional': 'sublimacion'
        };

        // CARGAR IM√ÅGENES DESDE LA BASE DE DATOS
        async function loadMachineImages() {
            try {
                const response = await fetch(
                    'https://ecommerce-diseno-grafico-production.up.railway.app/api/products'
                );
                const products = await response.json();
                products.forEach(product => {
                    if (!product.image || !product.name) return;
                    const normalizedName = normalizeText(product.name);
                    const machineKey = categoryMap[normalizedName];
                    if (!machineKey || !machines[machineKey]) return;
                    machines[machineKey].image = product.image;
                    console.log(`‚úî Imagen aplicada a ${machineKey}:`, product.image);
                });
                changeMachine(currentMachine);
            } catch (error) {
                console.error('‚ùå Error cargando im√°genes desde BD:', error);
            }
        }


        function getFullImageUrl(image) {
            if (!image) return null;

            // Si ya es URL completa (http o https), usarla tal cual
            if (image.startsWith('http://') || image.startsWith('https://')) {
                return image;
            }

            // Si es ruta relativa, completar con el backend
            return `https://ecommerce-diseno-grafico-production.up.railway.app${image}`;
        }
        const API_BASE = 'https://ecommerce-diseno-grafico-production.up.railway.app';

        function resolveImage(image) {
            if (!image || typeof image !== 'string') return null;
            if (image.startsWith('http://') || image.startsWith('https://')) {
                return image;
            }
            if (image.includes('uploads')) {
                return API_BASE + (image.startsWith('/') ? image : '/' + image);
            }

            return null;
        }


        // Cambiar m√°quina
        function changeMachine(machineKey) {
            const machine = machines[machineKey];
            if (!machine) return;

            currentMachine = machineKey;

            document.getElementById('heroTitle').textContent = machine.title || '';
            document.getElementById('heroDescription').textContent = machine.description || '';

            const imgEl = document.getElementById('machineImage');
            const imageUrl = resolveImage(machine.image);
            console.log('Cambiando imagen m√°quina:', imageUrl);
            imgEl.onerror = null;

            if (imageUrl) {
                imgEl.onerror = () => {
                    imgEl.onerror = null;
                    imgEl.src = '/img/placeholder-servicio.png';
                };
                imgEl.src = imageUrl;
            } else {
                imgEl.src = '/uploads/placeholder-servicio.png';
            }

            // üé® Colores
            const banner = document.querySelector('.main-banner');
            banner.style.setProperty('--primary', machine.colors.primary);
            banner.style.setProperty('--primary-dark', machine.colors.primaryDark);
            banner.style.setProperty('--accent', machine.colors.accent);
            banner.style.setProperty('--gradient', machine.colors.gradient);

            document.querySelectorAll('.tag').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.machine === machineKey);
            });
            const img = document.getElementById("machineImage");

            // limpiar estilos anteriores
            img.style.width = "";
            img.style.height = "";
            img.style.maxWidth = "";
            img.style.maxHeight = "";
            img.style.objectFit = "contain";

            // recalcular cuando cargue
            img.onload = () => {
                const w = img.naturalWidth;
                const h = img.naturalHeight;

                if (!w || !h) return;

                img.style.height = "auto";
                img.style.maxHeight = "420px";
                img.style.display = "block";
                img.style.margin = "0 auto";
            };

        }

        // Autoplay (orden fijo)
        function startAutoplay() {
            const machineKeys = (Array.isArray(BANNER_ORDER) ? BANNER_ORDER : Object.keys(machines))
                .filter(k => machines[k]);

            let currentIndex = machineKeys.indexOf(currentMachine);
            if (currentIndex < 0) currentIndex = 0;

            clearInterval(autoplayInterval);
            autoplayInterval = setInterval(() => {
                currentIndex = (currentIndex + 1) % machineKeys.length;
                changeMachine(machineKeys[currentIndex]);
            }, 5000);
        }

        function resetAutoplay() {
            startAutoplay();
        }
        // Cargar productos
        async function loadProducts() {
            try {
                const response = await fetch('https://ecommerce-diseno-grafico-production.up.railway.app/api/products');
                const products = await response.json();

                const featured = products
                    .filter(p =>
                        p.featured &&
                        p.category &&
                        p.category.toLowerCase() !== 'servicios'
                    )
                    .slice(0, 6);

                console.log('Productos destacados cargados:', featured);
                const grid = document.getElementById('productosGrid');

                grid.innerHTML = featured.map(product => {
                    // Convertir precios a n√∫meros
                    const price = parseFloat(product.price) || 0;
                    const salePrice = product.sale_price ? parseFloat(product.sale_price) : null;
                    const precio = salePrice || price;
                    const descuento = salePrice ? Math.round(((price - salePrice) / price) * 100) : 0;

                    return `
                        <div class="producto-card">
                            <div class="producto-img-container">
                                <img src="${product.image}" alt="${product.name}" class="producto-img">
                                ${product.featured && product.trending ?
                            '<div class="producto-badge destacado">‚ú® Destacado</div>' :
                            salePrice ?
                                `<div class="producto-badge oferta">-${descuento}% OFF</div>` :
                                ''
                        }
                            </div>
                            <div class="producto-content">
                                <div class="producto-categoria">${product.category}</div>
                                <h3>${product.name}</h3>
                                <p class="producto-description">${product.description}</p>
                                <div class="producto-footer">
                                    <div class="producto-precio-container">
                                        ${salePrice ?
                            `<div class="producto-precio-old">$${price.toFixed(2)}</div>` :
                            ''
                        }
                                        <div class="producto-precio">$${precio.toFixed(2)}</div>
                                    </div>
                                    <button class="producto-btn" onclick="window.location.href='/pages/product.html?id=${product.id}'">
                                        Ver m√°s <i class="fas fa-arrow-right"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            } catch (error) {
                console.error('Error cargando productos:', error);
                document.getElementById('productosGrid').innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 3rem; color: #666;">
                        <i class="fas fa-exclamation-circle" style="font-size: 3rem; margin-bottom: 1rem; color: #ccc;"></i>
                        <p>No se pudieron cargar los productos. Intenta recargar la p√°gina.</p>
                    </div>
                `;
            }
        }

        // Cargar galer√≠a
        async function loadGallery() {
            try {
                const response = await fetch('https://ecommerce-diseno-grafico-production.up.railway.app/api/products');
                const products = await response.json();

                // Tomar solo productos que tengan imagen
                const galleryProducts = products
                    .filter(p => p.image)
                    .slice(0, 9); // m√°ximo 9

                const grid = document.getElementById('galeriaGrid');

                if (!galleryProducts.length) {
                    grid.innerHTML = `
        <div style="grid-column: 1/-1; text-align: center; padding: 3rem;">
          <p>No hay productos para mostrar</p>
        </div>
      `;
                    return;
                }

                grid.innerHTML = galleryProducts.map(p => `
      <div class="galeria-item">
        <img src="${p.image}" alt="${p.name}">
        <div class="galeria-overlay">
          <h3>${p.name}</h3>
          <p>${p.category}</p>
        </div>
      </div>
    `).join('');

            } catch (error) {
                console.error('Error cargando galer√≠a din√°mica:', error);
            }
        }

        // User Menu
        document.addEventListener("DOMContentLoaded", function () {

            // Estado men√∫
            var userMenuOpen = false;

            const userMenuBtn = document.getElementById('userMenuBtn');
            const dropdown = document.getElementById('userDropdown');
            const userMenuContainer = document.querySelector('.user-menu-container');

            // Elementos de sesi√≥n
            const userInfo = document.getElementById('userInfo');
            const userName = document.getElementById('userName');
            const adminLink = document.getElementById('adminLink');
            const userGuest = document.getElementById('userGuest');

            function toggleUserMenu() {
                userMenuOpen = !userMenuOpen;
                dropdown.style.display = userMenuOpen ? 'block' : 'none';
            }

            // üëâ CONTROLAR ESTADO DE SESI√ìN
            function updateUserMenu() {
                const user = JSON.parse(localStorage.getItem('user'));

                if (user) {
                    userInfo.style.display = 'flex';
                    logoutBtn.style.display = 'flex';
                    userGuest.style.display = 'none';

                    userName.textContent = user.nombre || 'Usuario';
                    adminLink.style.display = user.role === 'admin' ? 'flex' : 'none';
                } else {
                    userInfo.style.display = 'none';
                    adminLink.style.display = 'none';
                    logoutBtn.style.display = 'none';
                    userGuest.style.display = 'block';
                }
            }

            // LOGOUT
            window.logout = function () {
                if (confirm('¬øEst√°s seguro de que deseas cerrar sesi√≥n?')) {
                    localStorage.removeItem('token');
                    localStorage.removeItem('user');
                    localStorage.removeItem('cart');

                    updateUserMenu();     // üî• CLAVE
                    toggleUserMenu();     // cerrar men√∫
                    window.location.href = '/pages/login.html';
                }
            };

            // Click bot√≥n usuario
            if (userMenuBtn) {
                userMenuBtn.addEventListener('click', function (e) {
                    e.stopPropagation();
                    toggleUserMenu();
                });
            }

            // Click fuera
            document.addEventListener('click', function (e) {
                if (userMenuOpen && userMenuContainer && !userMenuContainer.contains(e.target)) {
                    toggleUserMenu();
                }
            });

            // Ejecutar al cargar
            updateUserMenu();

        });
        // Actualizar info de usuario al cargar
        window.addEventListener('DOMContentLoaded', () => {
            const user = JSON.parse(localStorage.getItem('user') || '{}');
            const cart = JSON.parse(localStorage.getItem('cart') || '[]');

            // Actualizar nombre de usuario
            if (user.name) {
                document.getElementById('userName').textContent = user.name;
            }

            // Mostrar link de admin si es admin
            if (user.role === 'admin') {
                document.getElementById('adminLink').style.display = 'flex';
            }

            // Actualizar contador de carrito
            if (cart.length > 0) {
                const cartCount = document.getElementById('cartCount');
                cartCount.textContent = cart.length;
                cartCount.style.display = 'block';
            }
            // LISTENERS DE BOTONES DEL BANNER
            document.querySelectorAll('.tag[data-machine]').forEach(btn => {
                btn.addEventListener('click', () => {
                    changeMachine(btn.dataset.machine);
                    resetAutoplay();
                });
            });
        });

        // Iniciar - IMPORTANTE: Cargar im√°genes primero
        window.addEventListener('load', async () => {
            await loadMachineImages(); // Cargar im√°genes desde BD
            await loadProducts();      // Cargar productos
            startAutoplay();           // Iniciar carrusel
        });

        // Scroll suave
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({ behavior: 'smooth' });
                }
            });
        });
        async function loadDynamicContact() {
            try {
                const res = await fetch(`${API_URL}/settings`);
                const settings = await res.json();

                // Llenar los datos del contacto
                document.getElementById("contactAddress").textContent = settings.store_address || "Cargando...";
                document.getElementById("contactPhone").textContent = settings.store_phone || "Cargando...";
                document.getElementById("contactEmail").textContent = settings.store_email || "Cargando...";
                document.getElementById("contactHours").textContent = settings.store_schedule || "Cargando...";
            } catch (err) {
                console.error("Error cargando datos de contacto:", err);
            }
        }

        // Ejecutar cuando el documento est√© listo
        if (document.readyState === "loading") {
            document.addEventListener("DOMContentLoaded", loadDynamicContact);
        } else {
            loadDynamicContact();
        }
    </script>

    <!-- ‚ú® APLICAR COLORES ESTANDARIZADOS -->
    <script src="/js/apply-colors.js"></script>
    <script src="/js/common-footer.js"></script>
</body>

</html>